<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Feedback Form</title>

  <style>

.logo{
      align-items: center;
      justify-content: center;
      display: flex;
      margin: 10px;
      
    }
/* Updated styles for comment boxes */
.comments-container {
      display: flex;
      justify-content: space-between;
      gap: 20px;
      margin-top: 20px;
    }

    .comment-section {
      background: linear-gradient(
      135deg, 
      #16539f 0%, 
      #000000 100%
    );
      border-radius: 8px;
      padding: 15px;
      width: 50%;
      text-align: center;
    }

    .comment-section textarea {
      width: 90%;
      min-height: 80px; /* Reduced height */
      margin-top: 10px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      resize: vertical;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-size: 0.9em;
    }

    .comment-section label {
      font-weight: bold;
      color: #e5e8eb;
    }

    /* Mobile Responsiveness */
    @media screen and (max-width: 768px) {
      .comments-container {
        flex-direction: column;
        gap: 15px;
      }

      .comment-section {
        width: 95%;
        padding: 10px;
      }
      
      .comment-section textarea {
        min-height: 60px;
      }
    }
    body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(
      135deg, 
      #16539f 0%, 
      #000000 100%
    );
    margin: 0;
    padding: 0;
    line-height: 1.6;
  }
  p{
    color: white;
  }
  .span{
    color: red;
  }
  
  .container {
    width: 90%; /* Percentage-based width for better responsiveness */
    max-width: 1200px; /* Maximum width for larger screens */
    margin: 30px auto; /* Centered with reduced margin on mobile */
    padding: 20px; /* Reduced padding for mobile */
    box-sizing: border-box; /* Ensures padding doesn't increase overall width */
  }
  
  .container:hover {
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
  }
  
  h2, h3 {
    text-align: center;
    color: #2c3e50;
    margin-bottom: 20px;
  }
  
  h2 {
    font-size: 2.2em;
    color: #ebf5ff;
  }
  
  h3 {
    font-size: 1.8em;
    color: #e7ebee;
  }
  
  .info-section {
    background-color: #f9f9f9;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 25px;
    text-align: center;
    display: flex;
    justify-content: center;
    gap: 20px;
  }
  
  .info-section p {
    margin: 0;
    color: #11038a;
  }
  
  table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    margin-top: 25px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }
  
  table, th, td {
    border: 1px solid #e0e0e0;
    text-align: center;
    padding: 12px;
  }
  
  th {
    background-color: #3498db;
    color: white;
    font-weight: 600;
    text-transform: uppercase;
  }
  
  td {
    width: 150px;
    background-color: #f8f9fa;
    transition: background-color 0.3s ease;
  }
  
  td:hover {
    background-color: #e9ecef;
  }
  
  .rating-radio {
    display: flex;
    align-items: center;
    margin: 5px 0;
    width: 100%;
    justify-content: center;
  }
  
  .radio-buttons {
    display: flex;
    flex-direction: column; /* Vertical layout */
    align-items: center;
    gap: 10px; /* Space between radio buttons */
  }
  
  .radio-buttons input[type="radio"] {
    margin-right: 8px;
  }
  
  .btn-container {
    text-align: center;
    margin-top: 30px;
  }
  
  button {
    padding: 12px 25px;
    background-color: #2ecc71;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 1em;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  
  button:hover {
    background-color: #27ae60;
    transform: scale(1.05);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }
  
  /* Mobile Responsiveness */
  @media screen and (max-width: 768px) {
    .container {
      width: 95%; /* Slightly wider on smaller screens */
      max-width: none; /* Remove max-width restriction */
      padding: 10px; /* Reduced padding */
      margin: 15px auto; /* Centered with reduced margin */
      box-sizing: border-box; /* Ensure padding doesn't increase overall width */
    }
  
    h2 {
      font-size: 1.8em; /* Smaller font size for mobile */
    }
  
    h3 {
      font-size: 1.5em; /* Smaller font size for mobile */
    }
  
    .info-section {
      flex-direction: column;
      align-items: center;
      gap: 10px;
      padding: 10px;
    }
  
    .info-section p {
      text-align: center;
      margin: 5px 0;
    }
  
    table {
      width: 100%;
      font-size: 0.7em; /* Smaller font size */
      border-collapse: collapse;
    }
  
    table th, table td {
      padding: 6px; /* Reduced padding */
      word-wrap: break-word;
      max-width: 100px; /* Limit column width */
    }
  
    .radio-buttons {
      flex-direction: row; /* Horizontal layout for radio buttons */
      flex-wrap: wrap;
      justify-content: center;
      gap: 3px;
    }
  
    .rating-radio {
      align-items: center;
      margin: 2px;
    }
  
    .rating-radio input {
      margin: 0 2px;
    }
  
    button {
      width: 90%; /* Make button wider on mobile */
      padding: 10px 15px;
      font-size: 0.9em;
    }
  }
  
  /* Ultra-small device optimization */
  @media screen and (max-width: 480px) {
    .container {
      width: 100%; /* Full width on very small screens */
      margin: 5px 0; /* Minimal margin */
      padding: 5px; /* Minimal padding */
    }
  
    h2 {
      font-size: 1.6em;
    }
  
    h3 {
      font-size: 1.3em;
    }
  
    table {
      font-size: 0.6em; /* Even smaller on very small screens */
    }
  
    table th, table td {
      padding: 4px; /* Minimal padding */
      max-width: 80px;
    }
  
    .radio-buttons {
      gap: 3px;
    }
  
    .info-section p {
      font-size: 0.9em;
    }
  }
  
  /* Horizontal scrolling for tables on small screens */
  @media screen and (max-width: 768px) {
    .container {
      overflow-x: auto;
    }
  
    #feedback-table-container {
      max-width: 100%;
      overflow-x: auto;
    }
  }
  .logo {
      align-items: center;
      justify-content: center;
      display: flex;
      margin: 10px;
    }

    .logo img {
      width: 600px; /* Reduced from 900px */
      height: auto; /* Maintain aspect ratio */
      max-width: 100%; /* Ensure responsiveness */
    }

    /* Rest of your existing styles remain the same */
    .comments-container {
      display: flex;
      justify-content: space-between;
      gap: 20px;
      margin-top: 20px;
    }
    #particles-js {
      position: fixed;
      width: 100%;
      height: 100%;
      z-index: -1;
      top: 0;
      left: 0;
      background: linear-gradient(
        135deg, 
        #16539f 0%, 
        #000000 100%
      );
    }

    body {
      position: relative;
      overflow-x: hidden;
    }

    .container {
      position: relative;
      z-index: 10;
      background: rgba(255, 255, 255, 0);
      backdrop-filter: blur(1px);
      border-radius: 15px;
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0);
    }

    /* Interactive hover effects */
    .comment-section textarea:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
      transition: all 0.3s ease;
    }

    .rating-radio label {
      transition: transform 0.2s ease;
    }

    .rating-radio label:hover {
      transform: scale(1.1);
    }

    /* Button hover and click animation */
    button {
      position: relative;
      overflow: hidden;
    }

    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(120deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: all 0.5s;
    }

    button:hover::before {
      left: 100%;
    }

    /* Modal animation */
    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: scale(0.7);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    #summary-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1000;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      animation: modalSlideIn 0.3s ease-out;
      max-width: 90%;
      max-height: 90%;
      overflow: auto;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 999;
    }
  
    </style>

</head>

<body>
  

  <div class="container">
    <div class="logo">
      <img src="logo.png" width="900px">
    </div>
    <h2>Feedback Form</h2>
    <div class="info-section">
      <p><strong>Year:</strong> <span id="year-info"></span></p>
      <p><strong>Semester:</strong> <span id="semester-info"></span></p>
      <p><strong>Branch:</strong> <span id="branch-info"></span></p>
      <p><strong>Section:</strong> <span id="section-info"></span></p>
      <p><strong>Academic Year:</strong> <span id="academicYear-info"></span></p>
    </div>

    <h3>Teacher and Subject Feedback</h3>
    <p><span class="span">NOTE: </span> 1: POOR | 2: AVERAGE | 3: SATISFACTORY | 4: GOOD | 5: EXCELLENT</p>
    <div id="feedback-table-container"></div>

    <div class="comments-container">
      <div class="comment-section">
        <label for="teacher-comments">Comments about College:</label>
        <textarea id="teacher-comments" placeholder="Enter your comments..."></textarea>
      </div>

      <div class="comment-section">
        <label for="department-comments">Comments about Department:</label>
        <textarea id="department-comments" placeholder="Enter your comments..."></textarea>
      </div>
    </div>

    <div class="btn-container">
      <button type="button" id="submit-feedback">Submit Feedback</button>
    </div>
  </div>
  <div id="particles-js"></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/particles.js/2.0.0/particles.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Particle.js configuration
      particlesJS('particles-js', {
        particles: {
          number: {
            value: 80,
            density: {
              enable: true,
              value_area: 800
            }
          },
          color: {
            value: ['#3498db', '#2ecc71', '#e74c3c']
          },
          shape: {
            type: 'circle',
          },
          opacity: {
            value: 0.5,
            random: false,
            anim: {
              enable: false
            }
          },
          size: {
            value: 3,
            random: true,
            anim: {
              enable: false
            }
          },
          line_linked: {
            enable: true,
            distance: 150,
            color: '#ffffff',
            opacity: 0.4,
            width: 1
          },
          move: {
            enable: true,
            speed: 2,
            direction: 'none',
            random: false,
            straight: false,
            out_mode: 'out',
            bounce: false
          }
        },
        interactivity: {
          detect_on: 'canvas',
          events: {
            onhover: {
              enable: true,
              mode: 'repulse'
            },
            onclick: {
              enable: true,
              mode: 'push'
            },
            resize: true
          },
          modes: {
            repulse: {
              distance: 100,
              duration: 0.4
            },
            push: {
              particles_nb: 4
            }
          }
        },
        retina_detect: true
      });
    });

    const urlParams = new URLSearchParams(window.location.search);
    const year = urlParams.get("year");
    const semester = urlParams.get("semester");
    const branch = urlParams.get("branch");
    const section = urlParams.get("section");
    const academicYear = urlParams.get("academicYear");
    const teacherSubjectPairs = JSON.parse(urlParams.get("teacherSubjectPairs"));

    // Set info section values
    document.getElementById("year-info").textContent = year || 'N/A';
    document.getElementById("semester-info").textContent = semester || 'N/A';
    document.getElementById("branch-info").textContent = branch || 'N/A';
    document.getElementById("section-info").textContent = section || 'N/A';
    document.getElementById("academicYear-info").textContent = academicYear || 'N/A';

    const feedbackTableContainer = document.getElementById("feedback-table-container");
    const questions = [
      "Is the teacher punctual to class?",
      "Does the teacher explain concepts clearly?",
      "Does the teacher engage students in discussions?",
      "Does the teacher provide timely feedback?",
      "Does the teacher use examples effectively?",
      "Is the teacher approachable for doubts?",
      "Does the teacher maintain discipline in class?",
      "Are the teacher's notes and materials helpful?",
      "Does the teacher encourage student participation?",
      "Overall, are you satisfied with the teacher's performance?"
    ];

    // Function to render feedback table
    function renderFeedbackTable() {
      const table = document.createElement("table");
      table.innerHTML = `
        <tr>
          <th>Questions</th>
          ${teacherSubjectPairs.map(pair => `<th>${pair.teacher}<br>${pair.subject}</th>`).join('')}
        </tr>
      `;

      questions.forEach((question, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${index + 1}. ${question}</td>
          ${teacherSubjectPairs.map(pair => `
            <td>
              <div class="radio-buttons">
                ${['1','2','3','4','5'].map((label, i) => `
                  <label class="rating-radio">
                    <input type="radio" name="rating-${pair.teacher}-${pair.subject}-${index}" value="${6+i}">
                    ${label}
                  </label>
                `).join('')}
              </div>
            </td>
          `).join('')}
        `;
        table.appendChild(row);
      });

      feedbackTableContainer.appendChild(table);
    }

    renderFeedbackTable();

    // Function to create summary modal
    function createSummaryModal(summaryData) {
      // Remove any existing modal
      const existingModal = document.getElementById('summary-modal');
      const existingOverlay = document.querySelector('.modal-overlay');
      if (existingModal) existingModal.remove();
      if (existingOverlay) existingOverlay.remove();

      // Create modal overlay
      const overlay = document.createElement('div');
      overlay.className = 'modal-overlay';

      // Create modal container
      const modal = document.createElement('div');
      modal.id = 'summary-modal';
      
      // Create summary table
      const summaryTable = document.createElement('table');
      summaryTable.innerHTML = `
        <h2>Feedback Summary</h2>
        <table border="1">
          <thead>
            <tr>
              <th>Teacher</th>
              <th>Subject</th>
              <th>Question</th>
              <th>Total Responses</th>
              <th>Rating 6 (1)</th>
              <th>Rating 7 (2)</th>
              <th>Rating 8 (3)</th>
              <th>Rating 9 (4)</th>
              <th>Rating 10 (5)</th>
              <th>Total Percentage</th>
            </tr>
          </thead>
          <tbody>
            ${summaryData.map(summary => `
              <tr>
                <td>${summary.teacher}</td>
                <td>${summary.subject}</td>
                <td>${summary.question_id}</td>
                <td>${summary.total_responses}</td>
                <td>${summary.rating_6_count}</td>
                <td>${summary.rating_7_count}</td>
                <td>${summary.rating_8_count}</td>
                <td>${summary.rating_9_count}</td>
                <td>${summary.rating_10_count}</td>
                <td>${summary.total_percentage.toFixed(2)}%</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
        <button id="close-modal">Close</button>
      `;

      modal.appendChild(summaryTable);
      document.body.appendChild(overlay);
      document.body.appendChild(modal);

      // Close modal functionality
      document.getElementById('close-modal').addEventListener('click', () => {
        overlay.remove();
        modal.remove();
      });
    }

    document.getElementById("submit-feedback").addEventListener("click", () => {
      let allSelected = true;
      const feedbackData = [];
      const collegeComments = document.getElementById("teacher-comments").value;
      const departmentComments = document.getElementById("department-comments").value;

      teacherSubjectPairs.forEach(pair => {
        questions.forEach((_, index) => {
          const rating = document.querySelector(`input[name="rating-${pair.teacher}-${pair.subject}-${index}\"]:checked`);
          if (!rating) {
            allSelected = false;
          } else {
            feedbackData.push({
              teacher: pair.teacher,
              subject: pair.subject,
              question_id: index + 1,
              rating: parseInt(rating.value)
            });
          }
        });
      });

    
      if (allSelected) {
        fetch('http://192.168.72.97:3000/submit-feedback', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            year, 
            semester, 
            branch, 
            section, 
            academicYear, 
            feedbackData,
            collegeComments,
            departmentComments
          })
        })
        .then(response => {
          if (!response.ok) throw new Error(`Server error: ${response.statusText}`);
          return response.json();
        })
        .then(data => {
          alert("Feedback successfully submitted!");
          // Replace current history entry and redirect
          window.location.replace("tq.html");
        })
        .catch(err => {
          console.error("Error during submission:", err);
          alert("Something went wrong. Please try again later.");
        });
      } else {
        alert("Please fill in all ratings before submitting.");
      }
    });
  </script>
</body>
</html>